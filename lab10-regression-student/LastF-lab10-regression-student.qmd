---
title: "Lab 10: Simple Linear Regression"
author: "NAME"
format: html
embed-resources: true
html-math-method: mathml
execute: 
  warning: false
  echo: true
  error: false
---


## Before you start:

1. Complete the Lab Primer linked in Canvas.  
2. Be sure you have opened the `lab10-regression-student.Rproj` file.  
3. Change the name of the **QMD** file only to your last name, first initial, e.g., `OtterM-lab10-regression-student.qmd`. You will have to close the QMD document to rename the file. 
4. Change the "NAME" above after `author:` to your name, leaving it in quotes: "Monte Otter" 


## Skills

* Given a study, distinguish between explanatory and response variables
* Given a set of raw data, make a scatterplot or regression output using R
* Given a scatterplot, identify patterns such as positive and negative associations
* Given the least squares line and a value of x, calculate the predicted value of y
* Given standard regression output, identify and utilize key parts of the output (estimated slope, intercept, R^2^, etc.)
* State and test the assumptions of inference about the regression model
* Given a study objective, significance level, and summary statistics, conduct a formal test of significance on a slope based on ANOVA or the t-distribution by conducting the appropriate steps (including stating hypotheses, calculating test statistics, calculating and interpreting p-values and interpreting the conclusion in context).
* Be able to calculate and interpret the confidence interval for $\beta$ given output from a linear regression analysis. 
* Given standard regression output, interpret the results of the test of hypothesis about the slope.
* Given a study, interpret the value of the coefficient of determination (R^2^).
* Be able to describe the primary distinction between regression and correlation analysis.

New LTs covered in this lab include 17, 18, 20b, 23abc, plus 22ab, and others. R LTs include R2, R8, and R9.  


Here are some symbols that you might find useful:  
$H_0$  $H_1$  $\neq$  $\sigma$  $\mu$  $\mu_0$  $\mu_{word}$  $\rho$  $\beta_0$  $\beta_1$  $\hat{y}$  $\hat{y}_{word}$  $value \cdot x_{word}$  
 
***
*Markdown tip: putting two spaces after a line forces the next line in your markdown document to also be a new line in your knitted document.*

*Markdown tip: equations in Markdown will ignore any attempt to include spaces, unless you insert a `~` inside the equation where you want the space.* For example, in our BAC-Beers problem from class (hover your mouse over them to see what it would knit like): $x_{number of beers}$ versus $x_{number~of~beers}$ 

*Markdown tip: If you want to test out two lines of code, such as piped functions, you have to run them __together__, not one at a time.* 

*Markdown tip: you can run one line of code at a time by placing your cursor in it, then Ctl + Enter*
***

Update the following code chunk with the appropriate packages.  

```{r}
#| label: setup
#| include: false
library(tidyverse)

```


## Scenario 1: Palmer Penguins  

As part of the Palmer Station Long Term Ecological Research Program in Antarctica, Kristen Gorman has been collecting size measurements for adult foraging Adelie, Chinstrap, and Gentoo penguins observed on islands in the Palmer Archipelago near Palmer Station, Antarctica. The measurements include penguin species, size (flipper length, body mass, bill dimensions), and sex. Penguins were measured after a random number of other penguins were passed. We have been using the bill length to depth ratio in class; let's now investigate if a linear model with bill length can explain any differences in bill depth. The data are in `penguins.csv`.  
 

### 1.1.

Identify the variable type by completing the table below. Please **bold** your answers.

Variable       | Description                            | Type (Categorical or Numeric)
---------------|----------------------------------------|-------------------------------
bill_length_mm | Bill length (mm)                       |   
bill_depth_mm  | Bill depth (mm)                        |   
sex            | Penguin biological sex (male / female) |   
species        | Penguin species (Gentoo, Adelie, Chinstrap)  |


The researchers start by completing a linear regression analysis for the bill depth against bill length in all penguins; they expect there may be a negative linear relationship, as that makes sense given prey that penguins eat.    


### 1.2. 

State the null and alternative hypotheses for a regression hypothesis test of bill depth and bill length in penguins, both symbolically and verbally.  

> Insert your symbolic null here   
> Insert your verbal null here  

> Insert your symbolic alternative here  
> Insert your verbal alternative here  



### 1.3. 

Suppose the parametric conditions are met for this analysis. Conduct a linear regression analysis on these data. Modify the code below so it will create a linear model and display the summary table.  

```{r}
#| label: build-model-full
penguins <- read_csv("penguins.csv", show_col_types = FALSE) # do not change this code

peng_lm <- lm(_____ ~ _____, data = ______)
summary(_____)
```


### 1.4. 

Does the linear model with bill length explain much of the variability in bill depth of penguins in the Palmer Archipelago? How much variability does it explain? Does that seem like a good model to use for predictions (evaluate the strength of the model fit)?   

> Insert answer here  


The researchers notice that the strength of linear relationship may depend on sex of the penguin. To this end, the researchers considered two separate linear models, one for males and the other for females: 

```{r}
#| label: scatterplot-sex
## this graphic uses the same structure that you have learned, just color-codes given the cases' categorical variable state (color = ~Sex). The legend is made automatically given the variable name and levels.  You do not need to change anything in this code chunk; just run it to see the output 

gf_point(bill_depth_mm ~ bill_length_mm, data = penguins, 
         xlab = "Bill Length (mm)",
         ylab = "Palmer Penguin Bill Depth (mm)", 
         color= ~ sex) |>
  gf_lm() |> 
  gf_theme(theme_bw())
```


### 1.5. 

To analyze the linear relationships separately for each sex, we need to separate out the cases of each sex from our dataset. Fill in the blanks in the code below to extract out first the male and then the female cases from the original dataset (Hint: you learned this code earlier in the semester -- refer to your appendix/primer if you need a refresher). After you have done so, create the linear model for each. 

```{r}
#| label: build-models-separate
male <- filter(penguins, ____ == "_____")
fema <- filter(penguins, ____ == "_____")

male_lm <- ___(_____ ~ _____, data = male)
fema_lm <- ___(_____ ~ _____, data = fema)
```


### 1.6. 

Write the null and alternative hypotheses for a regression hypothesis of bill depth against bill length for *male* penguins in the Palmer Archipelago, both symbolically and verbally. The researcher's hypothesized expectations of the relationship have not changed.

> $H_{0,~male}$:  
> 
> $H_{1,~male}$:  
> 


### 1.7. 

Assess whether the parametric conditions of linear regression have been satisfied, for *only the males*; include any guidelines we should also check for our analyses. Modify the code to create the appropriate graphics. **For just the males**, state the condition, the plot you used as evidence, then whether it has been satisfied. Give a **brief** explanation of the pattern you saw that led to that decision. These are NOT full justifications. (Let your answers in the table wrap if needed; rendering will fix it. Do not add enters, as that will make the table not knit.) 


```{r}
#| label: condition-tests
# condition tests for males



```


*Male Regression*

Condition/Guideline      | Plot            | Satisfied or Violated?  | Pattern (only)
-------------------------|-----------------|-------------------------|-------------------
                         |                 |                         |
                         |                 |                         |
                         |                 |                         |
                         |                 |                         |
                         |                 |                         |



### 1.8. 

Create a summary table for the linear regression for each sex (one summary for males and one summary for females). Using the tables, determine the least squares regression lines for your linear models of each sex.   

<Insert code chunk here>  

> Write linear regression lines here, using markdown symbols  



### 1.9. 

Interpret the R^2^ value of the linear regression for *males*.    

>  Insert answer here  


### 1.10. 

Which sex has a linear regression with a stronger model fit? Provide and compare relevant statistics (one from the model of males and one from the model of females) then justify your answer.  

>  Insert answer here  


### 1.11. 

Determine the 95% confidence interval for the slope of the regression line for *males*. Insert a code to determine the interval, then evaluate it to answer the research question.  

<Insert code chunk here>  

> Insert answer here  


### 1.12. 

Write a strength of evidence statement for your regression analysis of *males*, using a significance level of 0.05.  

>  Insert answer here  


### 1.13. 

TRUE or FALSE (Bold your answer). Both males and females seem to be responding the same in relation to bill depth and bill length. (i.e., sex doesn't seem to matter in terms of the direction and strength of the linear association).  


### 1.14. 

TRUE or FALSE (Bold your answer). We could use these equations to predict bill depths beyond the scope of the values of the explanatory variable collected, such as predicting the bill depth for female penguins with a bill length of 70 mm. 


### 1.15. 

The probability that we find that there is no linear regression between bill depth and bill length, when that is not the truth is a description of what error?

> Insert answer here  


### 1.16. 

How can you be certain you did not make an error such as described above?  

> Insert answer here  


### 1.17. 

Can you trust the statistical methods used to calculate your inference results (p-value, confidence interval?) for the males? Justify your answer, including what the study has and why or why not that allows you to trust the results.

> Insert answer here  


### 1.18. 

Can we determine if bill length **caused** the decrease in bill depth in male penguins in the Palmer Archipelago? Explain why or why not with statistical reasoning. 

> Insert answer here  


### 1.20. 

Can we **generalize** our results to all male penguins of the three species in the Palmer Archipelago? Explain why or why not with statistical reasoning.     

> Insert answer here   


### 1.21 - Challenge Question  

Another group of researchers is questioning the analysis of the original group, saying they do not think a negative relationship makes sense for the penguin bill depth and length.  Try to produce graphs or summary statistics that supports their claim? What "paradox" did the original researchers potentially forget about?  

<Insert code chunk here>  

>Insert answer here


***

### Scenario 2: Primate Brain Size   

Human brains have a large frontal cortex with excessive metabolic demands compared with the brains of other primates. However, the human brain is also three or more times the size of the brains of other primates. Is it possible that the metabolic demands of the human frontal cortex are just an expected consequence of greater brain size? Sherwood et al. (2006) investigated this question.  Let's first look at the relationship of glia-neuron ratio (an indirect measure of the metabolic requirements of brain neurons) and the brain mass (grams) of *non-human* primates, to see if brain mass explains the glia-neuron ratio. The data set includes a random sample of one to two species from each Family of primates (which ensures the species sampled are considered independent).  

The data are found in `primate-glia-neuron-ratio.csv`.

 

### 2.1. 

Test the parametric assumptions and guidelines of linear regression for the simple linear regression of glia-neuron ratio as a function of brain mass for non-human primates. Insert the necessary code to create the appropriate graphics. State the condition, and justify your assessment of whether it has been met, citing appropriate evidence. 

```{r}
#| label: build-model-primate
primate <- read_csv("primate-glia-neuron-ratio.csv", show_col_types = FALSE) # do not change this line of code

<insert code here>
```

> Condition:  
> Justification:  

> add additional templates as needed




### 2.2. 

Now assess the parametric assumptions and guidelines of linear regression for the transformed linear regression of the glia-neuron ration and natural log transformed brain mass: `GliaNeuronRatio ~ log(BrainMass)`. The linear model with transformations has been created for you. List each assumption, the graph used to assess it, and whether you think the assumption has been satisfied or violated, justifying your answer.

```{r}
ln_pri_lm <- lm(GliaNeuronRatio ~ log(BrainMass), data = primate)

< Insert additional code >
```

Condition                | Plot            | Satisfied or Violated?  | Justification
-------------------------|-----------------|-------------------------|-------------------
                         |                 |                         |
                         |                 |                         |
                         |                 |                         |
                         |                 |                         |
                         |                 |                         |





**Take-home message**: Sometimes, the linear model assumptions are satisfied after taking an appropriate transformation of the explanatory variable and/or the response variable. In the data (primate-glia-neuron-ratio.csv), the transformation of the response variable led to (better) satisfying linear model assumptions.

